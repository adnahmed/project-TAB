# ⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
# ⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⣝⣿⣿⣿⣿⣟⣞⣿⣿⠻⣿⡻⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
# ⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣟⢿⣿⣿⣳⣝⢿⡯⣿⣿⡝⣞⡯⡇⢯⣫⡫⣯⢿⡻⣽⣿⡻⣽⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
# ⣿⣿⣿⣿⣿⣿⣕⢽⢿⣿⣿⣻⡺⣕⢟⢿⣳⢕⢯⡯⡽⡷⣝⢾⠹⣽⡝⡆⣧⢿⣝⢺⢝⣜⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
# ⣿⣿⣿⣿⣿⣿⣿⣮⣏⢿⡹⣓⡭⣿⣷⣕⢽⡳⡍⡧⡣⣛⣼⡫⣱⡿⡕⡹⡵⣏⢎⣖⢑⣿⢿⢝⢽⣿⣿⣿⣿⣿⣿⣿⣿⣿
# ⣿⣿⣿⣿⣿⣿⣿⣿⣾⣳⢽⢮⣿⡘⣞⢜⢗⢝⢼⡽⡌⣲⡳⡅⡷⡝⡌⡪⣻⢜⢌⢎⢢⢯⢇⢷⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
# ⣿⣿⣿⣿⣿⣿⣿⣿⣿⡟⢓⠹⣓⣯⡲⡱⡽⣸⢸⡯⣪⢮⢫⢪⢣⠣⡊⡪⣗⡥⡕⢅⢺⢑⢵⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
# ⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢀⢂⠱⣹⣞⢌⡿⣜⡺⣝⢜⠕⡣⡣⡑⢜⢐⡼⡯⡟⠜⠁⠄⠄⠈⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
# ⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢀⠂⠌⡂⣷⡣⢯⢲⡕⡕⠅⠌⡘⡜⢤⠱⡸⡝⠁⠄⠄⠄⠄⠄⢰⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
# ⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡐⡨⠐⠨⠻⡇⠇⡇⣫⢎⠌⠄⡂⠪⡪⠊⠄⠄⠄⠄⠄⠄⠄⠄⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
# ⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡇⡂⠡⠡⡑⠄⡑⢘⠘⠂⠁⠐⠈⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
# ⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡇⠌⡂⡑⡐⠅⣂⠂⡀⠂⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⣺⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
# ⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣧⠂⡂⢌⠂⣝⠂⢫⠄⠐⡸⠈⢊⢂⠄⠄⠄⠄⠄⠄⠄⠄⠄⢀⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
# ⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡐⠠⡑⢸⡅⠌⡀⡗⡸⡈⠄⠄⢑⠄⠄⠄⠄⠄⠄⠄⠄⠄⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
# ⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡇⠅⢌⢸⡂⠅⡀⢣⢳⠄⠄⠂⢐⠕⠄⠄⠄⠄⠄⠄⠄⠄⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
# ⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡇⡑⡐⣜⡅⢂⠐⢸⢸⠄⠐⠄⠄⢇⠂⠄⠄⠄⠄⠄⠄⠄⣺⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
# ⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣗⠌⠔⣜⡎⢀⠂⢸⢸⠄⠄⠂⠄⢕⠁⠄⠄⠄⠄⠄⠄⠄⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
# ⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡡⢑⢀⠂⡂⢈⠄⠠⠄⠈⡀⠄⠑⠁⠄⠄⠄⠄⠄⠄⠄⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
# ⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡇⡢⠂⡅⣐⣀⣂⣁⠄⡁⢀⠠⠄⠄⠄⠄⠄⠄⠄⠄⢸⣿⣿⣿⢿⢟⡟⣿⣿⣿⣿⣿⣿⣿
# ⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣧⣬⣐⣌⣎⣒⢆⢇⢏⢎⢖⢔⢆⢄⣀⣀⣀⡠⣔⠶⡽⣝⢵⡫⢮⢳⡱⡿⣽⣯⣿⣯⣿⣿
# ⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢿⣯⣿⣷⣿⣾⢿⣯⢿⢽⢞⢗⢟⡝⡮⣺⣘⡮⡮⢕⠕⡜⡜⡜⣕⡵⣽⢯⣷⣿⣾⡿⣿⣿
# ⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⣿⣞⣯⡛⡎⣝⣬⣧⣷⣳⣷⢷⣯⡳⡱⣱⢵⣵⣳⡾⣞⣷⣿⣽⣿⣷⣿⣾⣿⣿⣿
# ⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣯⣷⣿⣿⣿⣷⣿⣿⣿⣿⣯⣿⣿⣿⣿⣿⣿⣿⣿⣿⣯⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿

import os.path
import sys
from os import listdir
from os.path import abspath, dirname, isfile, join
from pydoc import importfile

from memoization import cached
from PyQt5 import QtWidgets
from PyQt5.QtCore import QSize
from PyQt5.QtGui import QFont, QIcon
from PyQt5.QtWidgets import (
    QApplication,
    QLabel,
    QLineEdit,
    QListWidget,
    QListWidgetItem,
    QMainWindow,
    QPushButton,
    QScrollBar,
    QToolBar,
)

global E
E = 0
global TEST
TEST = []
LINKS_PATH = "links"
global ExternalLinks


@cached
def get_external_links():
    LINK_FILES = [f for f in listdir(f"./{LINKS_PATH}")]
    return [f for f in LINK_FILES if isfile(join(LINKS_PATH, f))]


ExternalLinks = get_external_links()


def refresh():
    current_dir = dirname(abspath(__file__))
    for i in ExternalLinks:
        setattr(
            sys.modules[__name__],
            i.removesuffix(".py"),
            importfile(f"{current_dir}/{LINKS_PATH}/{i}"),
        )


refresh()


def goto(site: str):
    hi = getattr(sys.modules[__name__], site)
    hi.RUN(window)  # Using Links Module for Sites


def URL(site):
    Window.hisstory(Window, site)
    if "." in site:  # Links have reverse dns format
        site = site.split(".")[1] + "_" + site.split(".")[0]
        if site + ".py" in ExternalLinks:
            goto(site)
    else:
        pass


class Window(QMainWindow):
    def showSites(self):
        self.initUI()
        for i in ExternalLinks:
            br = i.removesuffix(".py")
            bruh = br.split("_")[1] + "." + br.split("_")[0]
            self.site = QListWidgetItem(bruh)
            self.list_widget.addItem(self.site)
            self.list_widget.show()

    def herlecture(self):
        self.initUI()
        txt = os.path.isfile("data/history.txt")
        if txt:
            f = open("data/history.txt", "r")
            global TEST
            global E
            if E == 0:
                for i in f:
                    self.ello = QListWidgetItem(i)
                    self.list_widget.addItem(self.ello)
                    self.list_widget.show()
                    TEST.append(self.ello)
                E = 1
            else:
                self.list_widget.hide()
                TEST = []
                E = 0
        else:
            self.ello = QLabel(
                "you haven't gone to any sites yet or your history file is absent. go to any site and it should be back.",
                self,
            )
            self.find = QPushButton("find sites here!", self)
            self.find.clicked.connect(self.showSites)
            self.layout.addRow(self.ello)
            self.layout.addRow(self.find)
            self.find.show()
            self.ello.show()

    def hisstory(self, site):
        txt = os.path.isfile("data/history.txt")
        if txt:
            f = open("data/history.txt", "a")
            f.write(f"\n{site}")
            f.close()
        else:
            f = open("data/history.txt", "x")
            f.write(f"{site}")
            f.close()

    def searchBtn(self):
        site = self.addressLineEdit.text()
        URL(site)

    def __init__(self):
        super().__init__()

        self.central_widget = QtWidgets.QWidget(self)
        self.setCentralWidget(self.central_widget)
        self.layout = QtWidgets.QFormLayout(self.central_widget)

        self.setWindowTitle("TAB")
        self.setWindowIcon(QIcon("icons/tab.png"))
        self.setGeometry(200, 200, 900, 600)

        toolbar = QToolBar()
        self.addToolBar(toolbar)

        self.homeButton = QPushButton()
        self.homeButton.setIcon(QIcon("icons/tab.png"))
        self.homeButton.setIconSize(QSize(30, 30))
        self.homeButton.clicked.connect(refresh)
        toolbar.addWidget(self.homeButton)

        self.historyButton = QPushButton()
        self.historyButton.setIcon(QIcon("icons/history.png"))
        self.historyButton.setIconSize(QSize(20, 20))
        self.historyButton.clicked.connect(self.herlecture)
        toolbar.addWidget(self.historyButton)

        self.addressLineEdit = QLineEdit()
        self.addressLineEdit.setFont(QFont("Arial", 18))
        toolbar.addWidget(self.addressLineEdit)

        self.searchButton = QPushButton()
        self.searchButton.setIcon(QIcon("icons/search.png"))
        self.searchButton.setIconSize(QSize(15, 15))
        self.searchButton.clicked.connect(self.searchBtn)
        toolbar.addWidget(self.searchButton)

        self.initUI()

    def initUI(self):
        self.central_widget = QtWidgets.QWidget(self)
        self.setCentralWidget(self.central_widget)
        self.layout = QtWidgets.QFormLayout(self.central_widget)

        self.list_widget = QListWidget(self)
        self.list_widget.hide()
        self.list_widget.setGeometry(75, 100, 750, 450)
        self.scroll_bar = QScrollBar(self)
        self.scroll_bar.setStyleSheet("background : lightgreen;")
        self.list_widget.setVerticalScrollBar(self.scroll_bar)


app = QApplication(sys.argv)
window = Window()
window.show()
sys.exit(app.exec_())
